%-------------------------------------------------------------------------------
%
% Fit the data to an ellipse
%
%-------------------------------------------------------------------------------
function [ds]  = four_eval_slen(ts,b,N)

%-------------------------------------------------------------------------------
% Construct the data matrix
np = length(ts);
A  = zeros(np,2*N+1);
Ap = zeros(np,2*N+1);
for m = 1:np
    A(m, 1 )  = 1;
    Ap(m, 1 ) = 0;
    for k = 1:2        
        for n = 1:N
            if k == 1
                A(m,1+n)    = cos(n*ts(m));
                Ap(m,1+n)   = -n*sin(n*ts(m));
            else
                A(m,1+n+N)  = sin(n*ts(m));
                Ap(m,1+n+N) = n*cos(n*ts(m));
            end            
        end
    end
end

%-------------------------------------------------------------------------------
% Construct the fit data
r      =  A*b;
rprime = Ap*b;

%-------------------------------------------------------------------------------
ds = sqrt( r.^2 + rprime.^2);

%-------------------------------------------------------------------------------
if size(ts,2) > 1
    ds = ds';
end

% four_dat = [ ...
%     r_four.*cos(ts)+xy0(1) ...
%     r_four.*sin(ts)+xy0(2)];


